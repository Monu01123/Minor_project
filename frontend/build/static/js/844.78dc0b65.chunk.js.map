{"version":3,"file":"static/js/844.78dc0b65.chunk.js","mappings":"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","sources":["components/Student/CourseContentPage.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useParams, useLocation } from \"react-router-dom\";\r\nimport ReactPlayer from \"react-player\";\r\nimport \"./CourseContentPage.css\";\r\nimport { useAuth } from \"../../Context/auth.js\";\r\nimport Navbar from \"../Home/NavBar.js\";\r\nimport noContent from \"./no-content.png\";\r\nimport jsPDF from 'jspdf'\r\nimport img from './Certificate1.png';\r\n\r\nconst CourseContentPage = () => {\r\n  const { courseId } = useParams();\r\n  const [courseContent, setCourseContent] = useState([]);\r\n  const [selectedVideo, setSelectedVideo] = useState(null);\r\n  const [watchedContentIds, setWatchedContentIds] = useState(new Set());\r\n  const [loading, setLoading] = useState(true);\r\n  const [isCompleted, setIsCompleted] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [auth] = useAuth();\r\n  const [isVideoWatched, setIsVideoWatched] = useState(false);\r\n  const playerRef = useRef(null);\r\n  const location = useLocation();\r\n  const courseName = location.state?.courseName;\r\n\r\n  useEffect(() => {\r\n    const fetchCourseContent = async () => {\r\n      try {\r\n        const token = auth?.token;\r\n        const response = await axios.get(\r\n          `http://localhost:8080/api/content/enrolled/${courseId}`,\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${token}`,\r\n            },\r\n          }\r\n        );\r\n        console.log(\"Course Content Response:\", response.data);\r\n        setCourseContent(response.data);\r\n        setSelectedVideo(response.data[0]?.content_url || null);\r\n      } catch (err) {\r\n        console.error(\"Error fetching course content:\", err);\r\n        setError(\"Error fetching course content\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    const fetchWatchedVideos = async () => {\r\n      if (!auth?.user?.user_id) return;\r\n\r\n      try {\r\n        const token = auth.token;\r\n        const response = await axios.get(\r\n          `http://localhost:8080/api/video/track/${auth.user.user_id}/${courseId}`,\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${token}`,\r\n            },\r\n          }\r\n        );\r\n\r\n        if (response.data) {\r\n          const contentIds = new Set(\r\n            response.data.map((item) => item.content_id)\r\n          );\r\n          console.log(\"Watched Content IDs:\", contentIds);\r\n          setWatchedContentIds(contentIds);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Error fetching watched videos:\", err);\r\n        setError(\"Error fetching watched videos\");\r\n      }\r\n    };\r\n\r\n    if (auth?.user) {\r\n      fetchWatchedVideos();\r\n      fetchCourseContent();\r\n    }\r\n  }, [courseId, auth]);\r\n\r\n  useEffect(() => {\r\n    const checkCompletion = async () => {\r\n      if (!auth?.user?.user_id) return;\r\n\r\n      try {\r\n        const response = await axios.post(\r\n          \"http://localhost:8080/api/check-completion\",\r\n          {\r\n            userId: auth.user.user_id,\r\n            courseId,\r\n          }\r\n        );\r\n        console.log(\"Course completion response:\", response.data);\r\n        setIsCompleted(response.data.completed);\r\n      } catch (error) {\r\n        console.error(\"Error checking course completion:\", error);\r\n        setError(\"Error checking course completion\");\r\n      }\r\n    };\r\n\r\n    checkCompletion();\r\n  }, [auth, courseId]);\r\n\r\n\r\n  const name = auth?.user?.full_name; \r\n  const course = courseName; \r\n  \r\n  const generateCertificate = () => {\r\n    // Create a new jsPDF instance\r\n    const doc = new jsPDF();\r\n  \r\n    // Add background image\r\n    doc.addImage(img, 'PNG', 0, 0, doc.internal.pageSize.getWidth(), doc.internal.pageSize.getHeight());\r\n  \r\n    // Add recipient name\r\n    doc.setFontSize(36);\r\n    doc.setFont('helvetica'); \r\n    doc.text(name, 105, 160, { align: 'center' }); \r\n\r\n    doc.setFontSize(15);\r\n    doc.text(\"instructor\", 122, 178.5);\r\n  \r\n    doc.setFontSize(20);\r\n    doc.text(course, 105, 195, { align: 'center' });\r\n  \r\n    doc.save(`${name}-${course}.pdf`);\r\n  };\r\n\r\n  const handleProgress = ({ played }) => {\r\n    if (played >= 0.5 && !isVideoWatched) {\r\n      setIsVideoWatched(true);\r\n      const contentItem = courseContent.find(\r\n        (content) => content.content_url === selectedVideo\r\n      );\r\n      if (contentItem) markVideoAsWatched(contentItem.content_id);\r\n    }\r\n  };\r\n\r\n  const markVideoAsWatched = async (contentId) => {\r\n    try {\r\n      const token = auth.token;\r\n      await axios.post(\r\n        \"http://localhost:8080/api/video/track\",\r\n        {\r\n          userId: auth.user.user_id,\r\n          courseId,\r\n          contentId,\r\n        },\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n        }\r\n      );\r\n      console.log(\"Video marked as watched\");\r\n      setWatchedContentIds((prev) => new Set(prev).add(contentId));\r\n    } catch (error) {\r\n      console.error(\"Error marking video as watched:\", error);\r\n      setError(\"Error updating video watch status\");\r\n    }\r\n  };\r\n\r\n  if (loading) return <p>Loading...</p>;\r\n  if (error) return <p>{error}</p>;\r\n  if (courseContent.length === 0)\r\n    return (\r\n      <>\r\n        <Navbar />\r\n        <div className=\"no-content-student\">\r\n          <div>\r\n            <img src={noContent} alt=\"No content available\" />\r\n            <p>No content available for this course.</p>\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n\r\n  return (\r\n    <>\r\n      <Navbar />\r\n      <div className=\"course-content-page\">\r\n        <div className=\"video-player\">\r\n          {selectedVideo ? (\r\n            <ReactPlayer\r\n              ref={playerRef}\r\n              url={selectedVideo}\r\n              controls\r\n              width=\"100%\"\r\n              height=\"auto\"\r\n              onProgress={handleProgress}\r\n              config={{\r\n                file: {\r\n                  attributes: {\r\n                    controlsList: \"nodownload\",\r\n                  },\r\n                },\r\n              }}\r\n            />\r\n          ) : (\r\n            <p>No video selected</p>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"content-list\">\r\n          <h3>{courseName ? `${courseName}` : \"Course Content\"}</h3>\r\n          {isCompleted && <button onClick={() => generateCertificate()} className=\"download-certificate\">Get Certificate</button>}\r\n          <ul>\r\n            {courseContent.map((content) => (\r\n              <li\r\n                key={content.content_id}\r\n                className={\r\n                  content.content_url === selectedVideo ? \"active selected-list-items\" : \"selected-list-items\"\r\n                }\r\n                \r\n                onClick={() => {\r\n                  if (content.content_url) {\r\n                    setSelectedVideo(content.content_url);\r\n                  } else {\r\n                    alert(\"You need to enroll to access this content.\");\r\n                  }\r\n                }}\r\n                style={{\r\n                  cursor: \"pointer\",\r\n                  borderBottom: watchedContentIds.has(content.content_id)\r\n                    ? \"4px solid red\"\r\n                    : \"none\",\r\n                }}\r\n              >\r\n                {content.title}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CourseContentPage;\r\n"],"names":["CourseContentPage","_location$state","_auth$user3","courseId","useParams","courseContent","setCourseContent","useState","selectedVideo","setSelectedVideo","watchedContentIds","setWatchedContentIds","Set","loading","setLoading","isCompleted","setIsCompleted","error","setError","auth","useAuth","isVideoWatched","setIsVideoWatched","playerRef","useRef","courseName","useLocation","state","useEffect","user","async","_auth$user","user_id","token","response","axios","get","concat","headers","Authorization","data","contentIds","map","item","content_id","console","log","err","fetchWatchedVideos","_response$data$","content_url","fetchCourseContent","_auth$user2","post","userId","completed","checkCompletion","name","full_name","course","markVideoAsWatched","contentId","prev","add","_jsx","children","length","_jsxs","_Fragment","Navbar","className","src","noContent","alt","ReactPlayer","ref","url","controls","width","height","onProgress","_ref","played","contentItem","find","content","config","file","attributes","controlsList","onClick","generateCertificate","doc","jsPDF","addImage","img","internal","pageSize","getWidth","getHeight","setFontSize","setFont","text","align","save","alert","style","cursor","borderBottom","has","title"],"sourceRoot":""}